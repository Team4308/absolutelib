name: Update Vendor JSON Version
on:
  push:
    tags: [ 'v*' ]

jobs:
  bump-json:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Extract version
        run: echo "REL_VERSION=${GITHUB_REF_NAME#v}" >> $GITHUB_ENV
      - name: Update JSON version
        run: |
          sed -i -E "s/\"version\": \"[0-9A-Za-z._-]+\"/\"version\": \"${REL_VERSION}\"/" absolutelib.json
          sed -i -E "s|(jsonUrl\": \")https://raw.githubusercontent.com/Team4308/absolutelib/[^\"]+(\")|\1https://raw.githubusercontent.com/Team4308/absolutelib/v${REL_VERSION}/absolutelib.json\2|" absolutelib.json
      - name: Commit change
        run: |
          git config user.name "github-actions"
          git config user.email "actions@users.noreply.github.com"
          git add absolutelib.json
          git commit -m "chore: update vendor JSON to ${REL_VERSION}"
          git push
